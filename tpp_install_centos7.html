<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-06-10 Fri 17:42 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>installing tpp on CentOS 7 - one man's journey</title>
<meta name="author" content="Malcolm Cook; Malcolm Cook" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.18/b-1.5.6/b-colvis-1.5.6/b-html5-1.5.6/b-print-1.5.6/cr-1.5.0/datatables.min.css"/>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.18/b-1.5.6/b-colvis-1.5.6/b-html5-1.5.6/b-print-1.5.6/cr-1.5.0/datatables.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/plug-ins/1.10.19/integration/font-awesome/dataTables.fontAwesome.css"/>
<style>.org-src-name {text-decoration: underline; font-style: italic; font-family: monospace;  border-left: 1em solid Yellow; }</style>
<style> content{max-width:1800px;}</style>
<style> p{max-width:100;}</style>
<style> img{max-width:1800px;}</style>
<style> li{max-width:1000;}</style>
<style> body{max-width:1000;}</style>
<script type='text/javascript' class="init">
$(document).ready(function() {
$('.org-src-name').on("click",(function(e){
$(this).next('.src').slideToggle();
}));
$('.src').show() // start out with listings (source code) - my clients mostly want RESULTS!!!
// allow to individually toggles src listing by clicking on its #+CAPTION (ASSUMING it has one).
$(document).keyup(function(e){
switch(e.keyCode){
// toggle/display/hide ALL source code listings on key y/alt-y (chosen to: (1) agree with 'yellow' (2) not conflict with +INFOJS_OPT keybindings).
case 89 : if (e.altKey) {$('.src').slideUp()} else if (e.ctrlKey) {$('.src').slideDown()} else { $('.src').slideToggle()} ; break;
}
});
//   $('table').stickyTableHeaders();
$('table th').css('background-color', 'white'); // opaque - better when "sticky".
//    $('table').addClass("dataTable");  // export ALL tables as dataTable.
//   $('div.org-results-container table [contains="adataTable"]).addClass("dataTable");
$('.dataTable').addClass("compact display"); // use these by default across the board!
$('.dataTable').css('display', 'block'); // compresses column widths (alas not table width)
$('.dataTable').dataTable({
// "stripeClasses": [ 'strip1', 'strip2', 'strip3' ], // class: display, //
// "autoWidth": true,
// "bAutoWidth": true,
responsive: false,
scrollX: false, // TRUE => columns misaligned !?!?
// scrollY: true,
// scrollCollapse: true,
"sDom": 'RCTlfriptB', // 'RClifrtip',
buttons: ['copy', 'csv', 'excel', 'pdf', 'print'],
//"dom": 'RCtilf<p>', //'T<clear>l<br>frtip', //T<clear>lfrtip',
"oTableTools": { "sSwfPath": "http://cdn.datatables.net/tabletools/2.2.4/swf/copy_csv_xls_pdf.swf" },
// "LengthChange": true,
"sPaginationType": "full_numbers", // "sScrollX": "100%",  "sScrollY": "100%",
"pagingType": "full_numbers",
"order": [], // take data in whatever order it comes in - do not apply default sort!
"aLengthMenu": [[10, 25, 50, 100, 1000, -1],
[10, 25, 50, 100, 1000, "All"]]
});
$("div.afterTable").html('<hr>');
} );
</script>
<script>
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
// @license-end
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">installing tpp on CentOS 7 - one man's journey</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org83b9802">1. Purpose</a></li>
<li><a href="#orgf9bd2d8">2. Methods</a></li>
</ul>
</div>
</div>

<div id="outline-container-org83b9802" class="outline-2">
<h2 id="org83b9802"><span class="section-number-2">1.</span> Purpose</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>enable using TPP in our centos7 environment</li>
<li>TODO: deploy as shared conda environment</li>
</ul>
</div>
</div>

<div id="outline-container-orgf9bd2d8" class="outline-2">
<h2 id="orgf9bd2d8"><span class="section-number-2">2.</span> Methods</h2>
<div class="outline-text-2" id="text-2">
<p>
Adapt <a href="http://tools.proteomecenter.org/wiki/index.php?title=TPP_6.1.0:_Installing_on_Ubuntu_20.04_LTS">TPP 6.1.0: Installing on Ubuntu 20.04 LTS</a> as needed.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>install libraries</label><pre class="src src-sh">sudo yum install -y gd-devel
sudo yum install -y libpng-devel
sudo yum install -y zlib-devel
sudo yum install -y bzip2-devel
sudo yum install -y subversion
sudo yum install -y build-essential
sudo yum install -y perl
sudo yum install -y zlib-devel
sudo yum install -y libghc-bzlib-devel
sudo yum install -y gnuplot
sudo yum install -y unzip
sudo yum install -y expat
sudo yum install -y expat-devel <span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">-devel</span>
sudo yum install -y libgd-devel
sudo yum install -y r-base
sudo yum install -y apache2 <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">NB: centos apache includes modules {rewrite,cgid} so no need for further installs</span>

<span style="color: #5F7F5F;">## </span><span style="color: #7F9F7F;">libs needed for compiler toolchain</span>
sudo yum install -y devtoolset-9
sudo yum install -y glibc-devel <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">for libc and libm (and friends) headers</span>
sudo yum install glibc-static <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">without which `g++ Comet.o -o comet.exe -static ...` (and others) fail with "cannot find {-lpthread,-lm,-lc} "</span>

<span style="color: #5F7F5F;">## </span><span style="color: #7F9F7F;">extra libs not mentioned in Ubuntu recipe or readme</span>
sudo yum install -y fann-devel 
<span style="color: #5F7F5F;">## </span><span style="color: #7F9F7F;">extra libs from taken from release_6-1-0/installer_linux/install-prerequisites-centos-5_2.sh - unclear if actually needed in centos 7 but hey</span>
sudo yum install -y mcrypt
sudo yum install -y swig
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 2: </span>get the source and unpack it in a working directory</label><pre class="src src-sh">mkdir ~/tpp_source <span style="color: #5F7F5F;">#</span><span style="color: #7F9F7F;">or somehwere you're going to build this thing</span>
<span style="color: #DCDCCC; font-weight: bold;">cd</span> ~tpp_source
wget https://sourceforge.net/projects/sashimi/files/Trans-Proteomic%20Pipeline%20%28TPP%29/TPP%20v6.1%20%28Parhelion%29%20rev%200/TPP_6.1.0-src.tgz
tar -zxvf TPP_6.1.0-src.tgz 
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 3: </span>create configuration file included by the make process to come</label><pre class="src src-sh"><span style="color: #DCDCCC; font-weight: bold;">cd</span> release_6-1-0
<span style="color: #DCDCCC; font-weight: bold;">echo</span> <span style="color: #CC9393;">'INSTALL_DIR = /usr/local/tpp'</span> &gt; site.mk
<span style="color: #DCDCCC; font-weight: bold;">echo</span> <span style="color: #CC9393;">'TPP_DATADIR = /data/tpp'</span> &gt;&gt; site.mk <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">note: recommend not using just '/data', as advised</span>
<span style="color: #DCDCCC; font-weight: bold;">echo</span> <span style="color: #CC9393;">'TPP_BASEURL = /tpp'</span> &gt;&gt; site.mk
<span style="color: #DCDCCC; font-weight: bold;">echo</span> <span style="color: #CC9393;">'TPP_DATAURL = /tpp/data'</span> &gt;&gt; site.mk
<span style="color: #DCDCCC; font-weight: bold;">echo</span> <span style="color: #CC9393;">'TPP_PORT = 10401'</span> &gt;&gt; site.mk
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 4: </span>create a user to own the tpp install, and directories to install and run the webserver</label><pre class="src src-sh">sudo useradd --system tpp <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">create tpp user with no home directory</span>
sudo mkdir /usr/local/tpp
sudo mkdir -p /data/tpp
sudo chown tpp.tpp /usr/local/tpp
sudo chown apache /data/tpp /usr/local/tpp/<span style="color: #DCDCCC;">{</span>users,log<span style="color: #DCDCCC;">}</span> <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">assuming your webserver is running as the default `apache` user.</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 5: </span>move into source directory</label><pre class="src src-sh"><span style="color: #DCDCCC; font-weight: bold;">cd</span> trans_proteomic_pipeline
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 6: </span>get a little report on what tpp thinks you're building on</label><pre class="src src-sh">make info
</pre>
</div>

<pre class="example" id="org4a9acfd">
ARCH = x86_64
VENDOR = redhat
SYSTEM = linux
    OS = Linux

TPP_VERSION = 6.1.0
TPP_RELEASE = Parhelion
TPP_BUILDID = TPP v6.1.0 Parhelion, Build 202206071204-exported (Linux-x86_64)

    SRC_DIR = /n/sci/SCI-004255-ZFPROT/tpp/svn/trans_proteomic_pipeline
  BUILD_DIR = /n/sci/SCI-004255-ZFPROT/tpp/svn/trans_proteomic_pipeline/build/linux-x86_64-release
INSTALL_DIR = /usr/local/tpp

   TPP_HOME = /usr/local/tpp
TPP_DATADIR = /data/tpp
TPP_BASEURL = /tpp
TPP_DATAURL = /tpp/data

 MZ5_SUPPORT is not enabled
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 7: </span>create your build environment.</label><pre class="src src-sh"><span style="color: #DCDCCC; font-weight: bold;">source</span> /opt/rh/devtoolset-9/enable <span style="color: #5F7F5F;">## </span><span style="color: #7F9F7F;">the newer compiler etc on your PATH</span>
<span style="color: #DCDCCC; font-weight: bold;">export</span> <span style="color: #DFAF8F;">LD_LIBRARY_PATH</span>=/usr/lib64:$<span style="color: #DCDCCC;">{</span><span style="color: #DFAF8F;">LD_LIBRARY_PATH</span><span style="color: #DCDCCC;">}</span> <span style="color: #5F7F5F;">## </span><span style="color: #7F9F7F;">needed for location of libc and libm else error: "/opt/rh/devtoolset-9/root/usr/libexec/gcc/x86_64-redhat-linux/9/ld: cannot find -lc"</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 8: </span>build it!</label><pre class="src src-sh">make all <span style="color: #5F7F5F;">## </span><span style="color: #7F9F7F;">NB: do NOT provide `-j` or `-k` options to make or problems will ensue.</span>
make all <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">yes, again!</span>
make all <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">keep doing this till nothing more is made!</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 9: </span>install it!</label><pre class="src src-sh"><span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">I'm installing from NFS share so can't install as root due to f-ing root squash</span>
sudo chown -R $<span style="color: #DFAF8F;">USER</span> /usr/local/tpp /data/tpp <span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">just for a minute....</span>
make install
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">now set them back again, as planned</span>
sudo chown -R tpp.tpp /usr/local/tpp
sudo chown -R apache /data/tpp /usr/local/tpp/<span style="color: #DCDCCC;">{</span>users,log<span style="color: #DCDCCC;">}</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 10: </span>install any missing perl libraries</label><pre class="src src-sh"><span style="color: #DCDCCC; font-weight: bold;">export</span> <span style="color: #DFAF8F;">PERL_MM_USE_DEFAULT</span>=1
yes | sudo cpan install CGI
sudo cpan install XML::Parser
yes | sudo cpan install XML::Twig
sudo cpan install FindBin::libs
yes | sudo cpan install JSON
sudo cpan install Tie::IxHash
sudo cpan install Statistics::Regression
sudo cpan install Statistics::R 
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 11: </span>test the perl library installation</label><pre class="src src-sh"><span style="color: #DCDCCC; font-weight: bold;">cd</span> /usr/local/tpp/bin
<span style="color: #DCDCCC; font-weight: bold;">export</span> <span style="color: #DFAF8F;">PERL5LIB</span>=/usr/local/tpp/lib/perl
./test_tpi.pl
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 12: </span>create an apache configuration file</label><pre class="src src-sh"><span style="color: #DCDCCC; font-weight: bold;">cd</span> /usr/local/tpp/conf

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Check your location with: http://www.whatsmyip.org/ and then configure the permission rules accordingly</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">cat httpd-2.4-tpp.conf | sed 's/Require ip 10/Require ip 174.250.12/' &gt; httpd-2.4-tpp-1.conf</span>

<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">Alternatively, you can allow traffic from anywhere. This might</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">expose your server to some security vulnerabilities, esp if you're</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">not running behind a firewall</span>
cat httpd-2.4-tpp.conf | sed <span style="color: #CC9393;">'s/#Require all granted/Require all granted/'</span> &gt; httpd-2.4-tpp-1.conf
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 13: </span>install the apache configuration file</label><pre class="src src-sh">sudo cp -p /usr/local/tpp/conf/httpd-2.4-tpp-1.conf /etc/httpd/httpd-tpp.conf
sudo systemctl reload apache2 
</pre>
</div>

<p>
You're done.  Test it.
</p>
</div>
</div>
</div>
</body>
</html>
